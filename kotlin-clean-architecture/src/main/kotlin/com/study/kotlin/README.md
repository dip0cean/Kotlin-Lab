## 계층형 아키텍처의 문제는 무엇일까?

### 계층형 아키텍처란?

> 웹 - 서비스 - 영속성계층으로 이루어진 아키텍처

#### 장점

- 누구나 이해하기 쉽다.
- 빠르게 변화하는 요구사항에 대해 즉각적으로 대응이 가능하다.

#### 단점

- 나쁜 개발 습관을 들이기 좋다.
- 시간이 지날 수록 유지보수가 어려운 소프트웨어로 변모하는 허점을 노출한다. 

---

### 데이터베이스 주도 설계를 유도하는 계층형 아키텍처

> 계층형 아키텍처는 비즈니스 로직이 영속성 계층에 많은 의존성을 가지게 되는데,
> 이로 인해 자연스럽게 데이터베이스에 의존하여 개발하게 되는데, 이는 행동(behavior)이 주가 되어
> 유스케이스나 도메인을 중점적으로 개발하는 것이 아니라 상태(state)를 기준으로
> 모델링 하게 된다.

#### 왜 데이터베이스 주도 설계를 `지양`해야 할까?

- 도메인의 행위(Behavior)가 아닌 상태(State)를 기준으로 모델링하게 된다.
- 도메인의 비즈니스 로직이 영속성 모델에 대해 깊이 의존하게 되어 강한 결합이 발생한다.
- 비즈니스 로직에 집중하는 것이 아닌, 영속성 모델을 처리하는 방식에 대해서도 개발해야 한다. (Eager / Lazy Loading, Transaction 등)
- 모든 계층이 영속성 계층에 의존하게 될 가능성이 커지며, 헬퍼나 유틸성 클래스들도 영속성 계층과 결합이 발생할 수 있다.
- 테스트를 하기가 어려워진다.
  - 간단히 필드를 조작하는 일이라도 도메인 로직을 웹 계층(Controller) 에 구현하게 된다. 이로 인해 계층 별 책임이 모호해지고, 핵심 로직이 계층을 벗어날 수 있다.
  - 웹 계층 테스트에서 도메인 계층뿐만 아니라 영속성 계층도 모킹(Mocking) 해야 하는 문제가 발생된다.
- 넓은 서비스 구현체를 개발하게 되면서 영속성 계층에 많은 의존성을 갖게되고, 이는 곧 많은 컴포넌트가 서비스에 의존하게 되는 문제를 야기한다.
- 동시 작업이 어려워진다.
